import{E as le,a as ie,b as ce}from"./el-dropdown.7dc8dd75.js";import{E as ue}from"./el-button.ad3d8374.js";/* empty css                        */import"./el-popper.39f5a9bb.js";import"./el-scrollbar.ffe35417.js";import{A as _e,B as de,E as pe,a as ve,s as fe,bZ as ge,r as p,b as me,H as he,w,f as s,e as ke,C as we,o as v,h as f,p as o,F as O,q as j,i as _,j as i,u as S,G as $,l as H,v as g,J as Se,D as $e,m as be,x as ye,y as xe}from"./entry.02f4b0bd.js";import{d as k}from"./default-user-icon.49878386.js";import{_ as Ae}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.ff8e5da0.js";const De=""+new URL("search.5b3fea75.svg",import.meta.url).href,Ue=""+new URL("new-chat.d41c9453.svg",import.meta.url).href,Ne=""+new URL("saved-messages.dcdaa155.svg",import.meta.url).href;const u=b=>(ye("data-v-12766468"),b=b(),xe(),b),Ce={class:"main"},Ie={class:"users"},Ee={key:0,class:"main__top"},We=["onClick"],Oe=u(()=>o("div",{class:"current__user-selector"},null,-1)),Je=["src"],Le=u(()=>o("i",{class:"el-icon-caret-bottom"},null,-1)),Pe=u(()=>o("span",null,"Logout",-1)),Re=u(()=>o("div",{class:"current__workspace-selector"},null,-1)),Me=["src","title","onClick"],ze={class:"main__bottom"},Be=u(()=>o("div",{class:"main__user-actions--add_button"},[o("span",null,"+")],-1)),Fe={class:"chats-header"},Te=u(()=>o("img",{src:De,alt:"",class:"chats__button-img"},null,-1)),Ve=u(()=>o("span",{class:"chats__button-text"},"Search",-1)),je=u(()=>o("img",{src:Ue,alt:"",class:"chats__button-img"},null,-1)),He=u(()=>o("span",{class:"chats__button-text"},"Create new chat",-1)),Ye=u(()=>o("img",{src:Ne,alt:"",class:"chats__button-img"},null,-1)),qe=u(()=>o("span",{class:"chats__button-text"},"Saved messages",-1)),Ge={__name:"Sidebar",setup(b){const d=_e(),J=de(),L=pe(),P=ve(),{profileSuccessData:U,profileFailureData:Y,editProfileData:q,editFailureData:G,workspacesSuccessData:N}=fe(d),{$myFetch:Z}=ge(),R=$e();p(k);const y=p(!0),K=be(),Q=p(null),x=me(),A=p(!1),t=p(!1),C=he(),n=p(null),m=p(!1),I=p(236),X=e=>{Q.value=e,e!=null&&e.user.avatar&&t.value[n.value]?t.value[n.value].avatarUrl=`${R.public.env.serverUrl}${e.avatarPath}/${e.user.avatar}`:t.value[n.value]&&(t.value[n.value].avatarUrl=`${k}`),localStorage.setItem("accounts",JSON.stringify(t.value))},M=e=>{t.value=JSON.parse(localStorage.getItem("accounts")),t.value[n.value]&&(t.value[n.value].workspaces=e==null?void 0:e.myWorkspaces),localStorage.setItem("accounts",JSON.stringify(t.value))};w(N,e=>M(e)),w(U,e=>{e!=null&&e.user.avatar&&n.value>=0?t.value[n.value].avatarUrl=`${R.public.env.serverUrl}${e.avatarPath}/${e.user.avatar}`:n.value>=0&&(t.value[n.value].avatarUrl=`${k}`),localStorage.setItem("accounts",JSON.stringify(t.value))}),w(G,e=>{(e==null?void 0:e.error)==="You don't have permission to access this resource"&&(s.remove("login_pin_token"),s.remove("settings_pin_token"),e=null,x.go())}),w(Y,e=>{(e==null?void 0:e.error)==="You don't have permission to access this resource"&&(s.remove("login_pin_token"),s.remove("settings_pin_token"),e=null,x.go())}),w(q,e=>{e!=null&&e.user.avatar?t.value[n.value].avatarUrl=`${e.avatarPath}/${e.user.avatar}`:t.value[n.value].avatarUrl=`${k}`,localStorage.setItem("accounts",JSON.stringify(t.value))}),ke(async()=>{{t.value=JSON.parse(localStorage.getItem("accounts")).filter(a=>a.token);const e=window.location.pathname.split("/");isNaN(+e[e.length-1])||(m.value=e[e.length-1],n.value=null)}!m.value&&s.get("currentAccountID")?n.value=+s.get("currentAccountID"):m.value||(n.value=0),s.get("login_pin_token")&&(U.value?X(U.value):d.getProfile(),N.value?M(N.value):await d.getWorkSpaces()),window.addEventListener("resize",ee)});const z=()=>{A.value="hovered"},B=()=>{A.value=!1},ee=()=>{window.innerWidth<800&&(y.value=!1),K.update()},E=async e=>{if(m.value=-1,n.value=e,s.set("currentAccountID",e),t.value[e].token===s.get("token")){g("/");return}if(d.$reset(),J.$reset(),L.$reset(),P.$reset(),(Date.parse(t.value[e].token_expires)-Date.now())/864e5<0){t.value.splice(e,1),localStorage.setItem("accounts",JSON.stringify(t.value)),t.value[0]?E(0):(Object.keys(s.get()).forEach(function(a){s.remove(a,neededAttributes)}),x.go());return}s.set("token",t.value[e].token,{expires:(Date.parse(t.value[e].token_expires)-Date.now())/864e5}),s.set("first_login",t.value[e].first_login),t.value[e].settings_pin_token&&s.set("settings_pin_token",t.value[e].settings_pin_token),t.value[e].login_pin_token&&s.set("login_pin_token",t.value[e].login_pin_token,{expires:(Date.parse(t.value[e].login_pin_token_expires)-new Date)/864e5}),localStorage.setItem("accounts",JSON.stringify(t.value)),t.value[e].first_login===!0?g("/pin"):C.path==="/pin"&&g("/"),d.getProfile(),await d.getWorkSpaces(),g("/")},te=e=>{n.value=-1,m.value=e,ae(e)},ae=e=>{g(`/workspace/staff/${e}`)},se=()=>{s.set("currentAccountID",t.value.length),s.set("addAccount",!0),window.open("/login","_blank")},oe=async e=>{t.value.forEach((l,D)=>l.ID=D),E(e),await Z("logout",{method:"post"});const a=t.value.map(l=>(l.ID===e&&(l.token=null,l.token_expires=null,l.first_login=null,l.settings_pin_token=null),l));d.$reset(),J.$reset(),L.$reset(),P.$reset();const r=a.findIndex(l=>l.token);a[r]?Date.parse(a[r].token_expires)-Date.now()>0?(s.set("token",a[r].token,{expires:(Date.parse(a[r].token_expires)-Date.now())/864e5}),a[r].first_login===!0&&s.set("first_login",a[r].first_login),a[r].settings_pin_token&&s.set("settings_pin_token",a[r].settings_pin_token),a[r].login_pin_token&&s.set("login_pin_token",a[r].login_pin_token,{expires:(Date.parse(a[r].login_pin_token_expires)-new Date)/864e5}),s.set("currentAccountID",r),d.getProfile(),await d.getWorkSpaces(),t.value=a,localStorage.setItem("accounts",JSON.stringify(a)),x.go()):a.shift():(s.remove("token"),s.remove("first_login"),s.remove("settings_pin_token"),s.remove("login_pin_token"),localStorage.setItem("accounts",JSON.stringify(a)),t.value=a,g("/login"))},F=(e,a)=>{switch(e){case"u":return a===n.value?"currentUser":!1;default:return a===+m.value?"currentWorkspace":!1}},ne=we(()=>t.value.reduce((e,a)=>(a.token&&e.push(a),e),[])),re=e=>{e.target.parentNode.style.cursor="e-resize",window.addEventListener("mousemove",T,!1),window.addEventListener("mouseup",()=>{e.target.parentNode.style.cursor="auto",window.removeEventListener("mousemove",T,!1)},!1)},T=e=>{I.value=e.x-68,I.value<85?y.value=!1:y.value=!0};return(e,a)=>{const r=le,l=ie,D=ce,W=ue;return v(),f("nav",Ce,[o("div",Ie,[t.value?(v(),f("div",Ee,[(v(!0),f(O,null,j(ne.value,c=>{var V;return v(),f(O,{key:c.ID},[_(D,{class:$(["main__user-actions",{currentUser:F("u",c.ID),bordered:(V=c.workspaces)==null?void 0:V.length}])},{dropdown:i(()=>[_(l,null,{default:i(()=>[_(r,{class:"main__user-actions--add_element",onClick:h=>oe(c.ID)},{default:i(()=>[Pe]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[o("div",{class:"main__user-actions--user",onClick:h=>E(c.ID)},[Oe,o("img",{src:c.avatarUrl?c.avatarUrl:S(k),alt:"Avatar",class:"main__user-actions--avatar"},null,8,Je),Le],8,We)]),_:2},1032,["class"]),(v(!0),f(O,null,j(c.workspaces,h=>(v(),f("div",{key:h.id,class:$(["main__user-workspaces",F("w",h.id)])},[Re,o("img",{src:c.avatarUrl?c.avatarUrl:S(k),alt:"Avatar",class:"main__user-workspaces--avatar",title:h.name,onClick:Ze=>te(h.id)},null,8,Me)],2))),128))],64)}),128))])):H("",!0),o("div",ze,[_(D,{class:"main__user-actions-add"},{dropdown:i(()=>[_(l,{class:"main__user-actions--add_actions"},{default:i(()=>[_(r,{class:"main__user-actions--add_element"},{default:i(()=>[o("span",{class:$(A.value),onClick:se,onMouseover:z,onMouseout:B}," Add account ",34)]),_:1}),_(r,{class:"main__user-actions--add_element"},{default:i(()=>[o("span",{class:$(A.value),onClick:a[0]||(a[0]=c=>("navigateTo"in e?e.navigateTo:S(g))("/create-workspace")),onMouseover:z,onMouseout:B}," Add workspace ",34)]),_:1})]),_:1})]),default:i(()=>[Be]),_:1})])]),S(C).path.includes("workspace")||S(C).fullPath=="/"?(v(),f("div",{key:0,class:$(["chats",y.value?"large":"small"]),style:Se({width:I.value+"px"})},[o("div",Fe,[_(W,{class:"chats__search"},{default:i(()=>[Te,Ve]),_:1}),_(W,{class:"chats__create"},{default:i(()=>[je,He]),_:1}),_(W,{class:"chats__saved"},{default:i(()=>[Ye,qe]),_:1})]),o("div",{class:"cursorbefore",onMousedown:re},null,32)],6)):H("",!0)])}}},rt=Ae(Ge,[["__scopeId","data-v-12766468"]]);export{rt as default};
