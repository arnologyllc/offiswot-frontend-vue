import{E as ce,a as ue,b as _e}from"./el-dropdown.74f9b8bd.js";import{E as pe}from"./el-button.932f9628.js";/* empty css                        */import"./el-popper.47a961d4.js";import"./el-scrollbar.04b23db5.js";import{b as de,D as ve,G as fe,a as ge,s as me,bY as he,r as d,e as ke,H as we,w as y,h as o,f as Se,E as De,o as g,i as m,j as n,F as J,v as T,k as _,l as c,u as w,B as $,p as Y,z as v,P as be,C as Ie,q as ye,x as $e,y as xe}from"./entry.571ec35c.js";import{d as x}from"./default-user-icon.a53f16b6.js";import{_ as Ue}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.4e138211.js";const Ne=""+new URL("search.5b3fea75.svg",import.meta.url).href,We=""+new URL("new-chat.d41c9453.svg",import.meta.url).href,Ce=""+new URL("saved-messages.dcdaa155.svg",import.meta.url).href;const u=U=>($e("data-v-6cb2a2e0"),U=U(),xe(),U),Ee={class:"main"},Ae={class:"users"},Oe={key:0,class:"main__top"},Pe=["onClick"],Je=u(()=>n("div",{class:"current__user-selector"},null,-1)),Le=["src"],Re=u(()=>n("i",{class:"el-icon-caret-bottom"},null,-1)),ze=u(()=>n("span",null,"Logout",-1)),Me=u(()=>n("div",{class:"current__workspace-selector"},null,-1)),Be=["src","title","onClick"],Fe={class:"main__bottom"},Te=u(()=>n("div",{class:"main__user-actions--add_button"},[n("span",null,"+")],-1)),Ye={class:"chats-header"},je=u(()=>n("img",{src:Ne,alt:"",class:"chats__button-img"},null,-1)),He=u(()=>n("span",{class:"chats__button-text"},"Search",-1)),qe=u(()=>n("img",{src:We,alt:"",class:"chats__button-img"},null,-1)),Ge=u(()=>n("span",{class:"chats__button-text"},"Create new chat",-1)),Ke=u(()=>n("img",{src:Ce,alt:"",class:"chats__button-img"},null,-1)),Qe=u(()=>n("span",{class:"chats__button-text"},"Saved messages",-1)),Ve={__name:"Sidebar",setup(U){const p=de(),j=ve(),H=fe(),q=ge(),{profileSuccessData:A,profileFailureData:G,editProfileData:K,editFailureData:Q,workspacesSuccessData:S}=me(p),{$myFetch:V}=he(),L=Ie(),N=d(!1),X=ye(),Z=d(null),W=ke(),C=d(!1),t=d(!1),D=we(),s=d(null),b=d(!1),ee=d(null),I=d(68),te=e=>{Z.value=e,e!=null&&e.user.avatar&&t.value[s.value]?t.value[s.value].avatarUrl=`${L.public.env.serverUrl}${e.avatarPath}/${e.user.avatar}`:t.value[s.value]&&(t.value[s.value].avatarUrl=`${x}`),localStorage.setItem("accounts",JSON.stringify(t.value))},O=e=>{t.value=JSON.parse(localStorage.getItem("accounts")),t.value[s.value]&&(e!=null&&e.myWorkspaces.length||e!=null&&e.inviteWorkspaces.length)&&(t.value[s.value].workspaces=[...e==null?void 0:e.myWorkspaces,...e==null?void 0:e.inviteWorkspaces]),localStorage.setItem("accounts",JSON.stringify(t.value))};y(S,e=>{O(S.value)}),y(A,e=>{e&&(s.value=+o.get("currentAccountID"),e!=null&&e.user.avatar&&s.value>=0?t.value[s.value].avatarUrl=`${L.public.env.serverUrl}${e.avatarPath}/${e.user.avatar}`:s.value>=0&&(t.value[s.value].avatarUrl=`${x}`),localStorage.setItem("accounts",JSON.stringify(t.value)),e.user.email&&(ee.value=e.user.email))}),y(Q,e=>{(e==null?void 0:e.error)==="You don't have permission to access this resource"&&(o.remove("login_pin_token"),o.remove("settings_pin_token"),e=null,W.go())}),y(G,e=>{(e==null?void 0:e.error)==="You don't have permission to access this resource"&&(o.remove("login_pin_token"),o.remove("settings_pin_token"),e=null,W.go())}),y(K,e=>{e!=null&&e.user.avatar?t.value[s.value].avatarUrl=`${e.avatarPath}/${e.user.avatar}`:t.value[s.value].avatarUrl=`${x}`,localStorage.setItem("accounts",JSON.stringify(t.value))}),Se(async()=>{{t.value=JSON.parse(localStorage.getItem("accounts")).filter(a=>a.token);const e=window.location.pathname.split("/");isNaN(+e[e.length-1])||(b.value=e[e.length-1])}s.value=+o.get("currentAccountID"),o.get("login_pin_token")&&(A.value?te(A.value):p.getProfile(),S.value||await p.getWorkSpaces(),O(S.value)),window.addEventListener("resize",ae),window.innerWidth<800&&(N.value=!1,I.value=68)});const R=()=>{C.value="hovered"},z=()=>{C.value=!1},ae=()=>{window.innerWidth<800&&(N.value=!1,I.value=68),X.update()},E=async(e,a,...r)=>{if(b.value="",s.value=t.value.findIndex(l=>l.email===e),o.set("currentAccountID",s.value),t.value[s.value].token===o.get("token")){v("/");return}if(p.$reset(),(Date.parse(t.value[s.value].token_expires)-Date.now())/864e5<0){t.value.splice(s.value,1),localStorage.setItem("accounts",JSON.stringify(t.value)),t.value[0]?E(0):(Object.keys(o.get()).forEach(function(l){o.remove(l,neededAttributes)}),W.go());return}o.set("token",t.value[s.value].token,{expires:(Date.parse(t.value[s.value].token_expires)-Date.now())/864e5}),o.set("remember_token",t.value[s.value].remember_token),o.set("first_login",t.value[s.value].first_login),t.value[s.value].settings_pin_token?o.set("settings_pin_token",t.value[s.value].settings_pin_token):o.remove("settings_pin_token"),t.value[s.value].login_pin_token?o.set("login_pin_token",t.value[s.value].login_pin_token,{expires:(Date.parse(t.value[s.value].login_pin_token_expires)-new Date)/864e5}):o.remove("login_pin_token"),localStorage.setItem("accounts",JSON.stringify(t.value)),t.value[s.value].first_login===!0?v("/pin"):D.path==="/pin"&&v("/"),p.getProfile(),await p.getWorkSpaces(),a||v("/")},se=async(e,a)=>{await E(a),b.value=e,oe(e)},oe=e=>{e===+D.path.split("/").pop()?v(`/workspace/staff/${e}`):v(`/workspace/staff/${e}`)},ne=()=>{o.set("currentAccountID",t.value.length),o.set("addAccount",!0),window.open("/login","_blank")},re=async e=>{t.value.forEach((l,f)=>l.ID=f),E(e),await V("logout",{method:"post"});const a=t.value.map(l=>(l.email===e&&(l.token=null,l.token_expires=null,l.first_login=null,l.settings_pin_token=null),l));p.$reset(),j.$reset(),H.$reset(),q.$reset();const r=a.findIndex(l=>l.token);a[r]?Date.parse(a[r].token_expires)-Date.now()>0?(o.set("token",a[r].token,{expires:(Date.parse(a[r].token_expires)-Date.now())/864e5}),a[r].first_login===!0&&o.set("first_login",a[r].first_login),a[r].settings_pin_token&&o.set("settings_pin_token",a[r].settings_pin_token),a[r].login_pin_token&&o.set("login_pin_token",a[r].login_pin_token,{expires:(Date.parse(a[r].login_pin_token_expires)-new Date)/864e5}),o.set("currentAccountID",r),p.getProfile(),(!(a!=null&&a.workspaces)||!(a!=null&&a.workspaces[0]))&&await p.getWorkSpaces(),t.value=a,localStorage.setItem("accounts",JSON.stringify(a)),W.go()):a.shift():(o.remove("token"),o.remove("first_login"),o.remove("settings_pin_token"),o.remove("login_pin_token"),localStorage.setItem("accounts",JSON.stringify(a)),t.value=a,v("/login"))},M=(e,a,r,l)=>{var f,h;switch(e){case"u":return((f=P.value[s.value])==null?void 0:f.email)===r&&!b.value?"currentUser":!1;default:return l===+b.value&&((h=P.value[s.value])==null?void 0:h.email)===r?"currentWorkspace":!1}},P=De(()=>t.value.reduce((e,a)=>(a.token&&e.push(a),e),[])),le=e=>{e.target.parentNode.style.cursor="e-resize",window.addEventListener("mousemove",B,!1),window.addEventListener("mouseup",()=>{e.target.parentNode.style.cursor="auto",window.removeEventListener("mousemove",B,!1)},!1)},B=e=>{I.value=e.x-68,N.value=I.value>85};return(e,a)=>{const r=ce,l=ue,f=_e,h=pe;return g(),m("nav",Ee,[n("div",Ae,[t.value?(g(),m("div",Oe,[(g(!0),m(J,null,T(P.value,(i,ie)=>{var F;return g(),m(J,{key:i.ID},[_(f,{class:$(["main__user-actions",{currentUser:M("u",ie,i.email),bordered:(F=i.workspaces)==null?void 0:F.length}])},{dropdown:c(()=>[_(l,null,{default:c(()=>[_(r,{class:"main__user-actions--add_element",onClick:k=>re(i.email)},{default:c(()=>[ze]),_:2},1032,["onClick"])]),_:2},1024)]),default:c(()=>[n("div",{class:"main__user-actions--user",onClick:k=>E(i.email)},[Je,n("img",{src:i.avatarUrl?i.avatarUrl:w(x),alt:"Avatar",class:"main__user-actions--avatar"},null,8,Le),Re],8,Pe)]),_:2},1032,["class"]),(g(!0),m(J,null,T(i.workspaces,k=>(g(),m("div",{key:k.id,class:$(["main__user-workspaces",M("w",i.ID,i.email,k.id)])},[Me,n("img",{src:i.avatarUrl?i.avatarUrl:w(x),alt:"Avatar",class:"main__user-workspaces--avatar",title:k.name,onClick:Xe=>se(k.id,i.email)},null,8,Be)],2))),128))],64)}),128))])):Y("",!0),n("div",Fe,[_(f,{class:"main__user-actions-add"},{dropdown:c(()=>[_(l,{class:"main__user-actions--add_actions"},{default:c(()=>[_(r,{class:"main__user-actions--add_element"},{default:c(()=>[n("span",{class:$(C.value),onClick:ne,onMouseover:R,onMouseout:z}," Add account ",34)]),_:1}),_(r,{class:"main__user-actions--add_element"},{default:c(()=>[n("span",{class:$(C.value),onClick:a[0]||(a[0]=i=>("navigateTo"in e?e.navigateTo:w(v))("/profile/choose-account")),onMouseover:R,onMouseout:z}," Add workspace ",34)]),_:1})]),_:1})]),default:c(()=>[Te]),_:1})])]),w(D).path.includes("workspace")&&!w(D).path.includes("create-workspace")||w(D).fullPath=="/"?(g(),m("div",{key:0,class:$(["chats",N.value?"large":"small"]),style:be({width:I.value+"px"})},[n("div",Ye,[_(h,{class:"chats__search"},{default:c(()=>[je,He]),_:1}),_(h,{class:"chats__create"},{default:c(()=>[qe,Ge]),_:1}),_(h,{class:"chats__saved"},{default:c(()=>[Ke,Qe]),_:1})]),n("div",{class:"cursorbefore",onMousedown:le},null,32)],6)):Y("",!0)])}}},it=Ue(Ve,[["__scopeId","data-v-6cb2a2e0"]]);export{it as default};
