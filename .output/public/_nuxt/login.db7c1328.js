import{E as J,_ as T,a as N,b as R}from"./el-overlay.1dfa5af6.js";import{E as j}from"./el-checkbox.6cda84b5.js";import{E as G}from"./el-button.d70bea62.js";import{G as W,s as X,r as b,w as L,e as K,h as f,i,j as v,k as u,u as s,l as Q,c as V,m as c,p as Y,o as m,t as M,B as Z,y as C,z as ee,v as oe,x as se,f as d}from"./entry.5f1d1580.js";import{_ as le,a as te}from"./OvConfirmEmailModal.b2bfc1cd.js";import{_ as ie}from"./lock-icon.ba2728cc.js";import{L as re}from"./LoginButtons.3753a0c9.js";import{E as P}from"./ErrorMassageModal.5752f234.js";import{h as ae,s as ne}from"./eye-close-icon.5b83d1d5.js";import{_ as ue}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.6fbf02b7.js";import"./isEqual.c51d8483.js";import"./flatten.46b97ead.js";import"./email-primary-icon.cfc345b0.js";import"./chevron-icon.ef7511c5.js";const p=S=>(oe("data-v-e7fa5156"),S=S(),se(),S),me={class:"main"},de={class:"main__form"},pe=p(()=>i("div",{class:"main__form--title"},"Log In",-1)),_e=p(()=>i("div",{class:"main__form--subtitle"},"Please fill the forms to log in",-1)),ce={key:0,class:"el-form-item__global-error-container"},ge={class:"el-form-item__global-error"},fe=p(()=>i("img",{src:T,alt:""},null,-1)),ve=p(()=>i("img",{src:te,alt:"user_icon"},null,-1)),we=p(()=>i("span",{for:"email",class:"custom_placeholder"}," Email ",-1)),ke=[we],be=p(()=>i("div",null,null,-1)),ye={key:0,class:"el-form-item__error"},xe=p(()=>i("div",null,null,-1)),Se=p(()=>i("img",{src:ie,alt:"password_icon"},null,-1)),he=p(()=>i("span",{for:"password",class:"custom_placeholder"}," Password ",-1)),Ee=[he],Ie=["src"],De={key:0,class:"el-form-item__error"},$e=["innerHTML"],Ve=p(()=>i("div",null,null,-1)),Ce={class:"forgot-password"},Te=p(()=>i("span",{style:{"font-weight":"400"}},"Remember me",-1)),Be={__name:"login",setup(S){const h=W(),{loginSuccessData:A,loginErrorData:q}=X(h),E=Y(),I=b(!1),D=b(!1),w=b(!1),_=b({ID:null,email:null,avatarUrl:null,token:null,token_expires:null,first_login:null,settings_pin_token:null,login_pin_token:null,login_pin_token_expires:null,remember_token:null,workspaces:null}),n=b({email:null,password:null,remember_me:!1}),l=b({email:{value:"",isShow:!1},password:{value:"",isShow:!1},global:{value:""}}),O=b({email:[{required:!0,message:"This field is required.",trigger:"blur"}],password:[{required:!0,message:"This field is required.",trigger:"blur"}]});L(A,o=>{d.remove("token"),d.remove("first_login"),d.remove("settings_pin_token"),d.remove("remember_token"),d.remove("login_pin_token"),d.remove("addAccount"),w.value=localStorage.getItem("accounts")!=="undefined"?JSON.parse(localStorage.getItem("accounts")):[],w.value.forEach((x,t)=>{x.email===o.user.email&&(_.value=x,w.value.splice(t,1))});const[e,a]=[o.access_token,o.is_first_login],g=1/24,r=new Date;r.setHours(r.getHours()+1),_.value.token_expires=r,d.set("token",e,{expires:g}),d.set("remember_token",o.remember_token);const $=(Date.parse(_.value.login_pin_token_expires)-Date.now())/864e5;_.value.login_pin_token&&d.set("login_pin_token",_.value.login_pin_token,{expires:$}),_.value.email=o.user.email,_.value.token=e,_.value.first_login=a,_.value.remember_token=o.remember_token,w.value.push(_.value),w.value.forEach((x,t)=>x.ID=t),d.set("currentAccountID",w.value.length-1),localStorage.setItem("accounts",JSON.stringify(w.value)),a?(C("/pin"),d.set("first_login",a)):C("/")}),L(q,o=>{if(o==="Please visit your email to verify your account."||(o==null?void 0:o.error)==="Please visit your email to verify your account."){h.resendEmail(n.value.email),D.value=!0;return}if(o==="Incorrect email or password."&&(l.value.global.value=o),typeof o!="string")for(const e in o)if(typeof o[e]!="string")for(const a in o[e])l.value.global.value=o[e][a];else l.value.global.value=o[e]}),K(()=>{const o=new Date;o.setDate(o.getDate()+30),window.addEventListener("resize",z)});const U=()=>{E.refs.loginForm.validate(o=>{var e,a;if(o){const g=localStorage.getItem("accounts")!=="undefined"?(a=(e=JSON.parse(localStorage.getItem("accounts")))==null?void 0:e.map(r=>(Date.parse(r.token_expires)<new Date&&(r.token=null,r.token_expires=null,r.settings_pin_token=null),r)))==null?void 0:a.filter(r=>Date.parse(r.login_pin_token_expires)>new Date):[];g!=null&&g.some(r=>r.email===n.value.email&&r.token)?l.value.global.value="Account already logged in":(localStorage.setItem("accounts",JSON.stringify(g)),h.loginUser(n.value))}else return l.value.global.value="Please fill empty areas",!1})},B=o=>{E.refs[o].focus()},F=o=>{E.refs.loginForm.validateField(o,(e,a)=>{e?l.value[o].value="":l.value[o].value=a[o][0].message})},y=(o,e)=>{k()?l.value[o].isShow=e==="mouseover":e==="click"&&(l.value[o].isShow=!0)},z=()=>{E.update()},k=()=>window.innerWidth>990,H=()=>{l.value.global.value=""};return(o,e)=>{const a=N,g=R,r=j,$=G,x=J;return m(),f("div",me,[i("div",de,[pe,_e,v(x,{ref:"loginForm",class:"main__form--box","hide-required-asterisk":"",model:s(n),rules:s(O),onSubmit:Q(U,["prevent"])},{default:u(()=>[s(l).global.value?(m(),f("div",ce,[i("div",ge,[fe,i("span",null,M(s(l).global.value),1)]),i("span",{class:"clear-error",onClick:H},"X")])):c("",!0),v(g,{prop:"email"},{error:u(()=>[s(l).email.isShow&&k()?(m(),f("div",ye,[i("span",null,M(s(l).email.value),1)])):c("",!0),xe]),default:u(()=>[v(a,{ref:"email",modelValue:s(n).email,"onUpdate:modelValue":e[4]||(e[4]=t=>s(n).email=t),class:"main__form--box__input",placeholder:"Email",onBlur:e[5]||(e[5]=t=>F("email"))},{prefix:u(()=>[ve]),suffix:u(()=>[s(l).email.value?(m(),f("img",{key:0,class:"error_icon",src:T,alt:"",onMouseover:e[0]||(e[0]=t=>y("email","mouseover")),onMouseout:e[1]||(e[1]=t=>y("email","mouseout")),onClick:e[2]||(e[2]=t=>y("email","click"))},null,32)):c("",!0),s(n).email?(m(),f("div",{key:1,style:{position:"relative"},onClick:e[3]||(e[3]=t=>B("email"))},ke)):c("",!0),be]),_:1},8,["modelValue"])]),_:1}),v(g,{prop:"password",class:"password-form-item"},{error:u(()=>[s(l).password.isShow&&k()?(m(),f("div",De,[i("span",{innerHTML:s(l).password.value},null,8,$e)])):c("",!0),Ve]),default:u(()=>[v(a,{id:"password",ref:"password",modelValue:s(n).password,"onUpdate:modelValue":e[11]||(e[11]=t=>s(n).password=t),type:s(I)?"text":"password",class:"main__form--box__input",placeholder:"Password",onBlur:e[12]||(e[12]=t=>F("password"))},{prefix:u(()=>[Se]),suffix:u(()=>[s(n).password?(m(),f("div",{key:0,style:{position:"relative"},onClick:e[6]||(e[6]=t=>B("password"))},Ee)):c("",!0),i("img",{class:Z(s(l).password.value?"eye_icon":""),src:s(I)?s(ae):s(ne),alt:"eye_icon",onClick:e[7]||(e[7]=t=>I.value=!s(I))},null,10,Ie),s(l).password.value?(m(),f("img",{key:1,src:T,alt:"",class:"error_icon",onMouseover:e[8]||(e[8]=t=>y("password","mouseover")),onMouseout:e[9]||(e[9]=t=>y("password","mouseout")),onClick:e[10]||(e[10]=t=>y("password","click"))},null,32)):c("",!0)]),_:1},8,["modelValue","type"]),i("div",Ce,[v(r,{modelValue:s(n).remember_me,"onUpdate:modelValue":e[13]||(e[13]=t=>s(n).remember_me=t),class:"remember-checkbox"},{default:u(()=>[Te]),_:1},8,["modelValue"]),v($,{text:"",onClick:e[14]||(e[14]=t=>("navigateTo"in o?o.navigateTo:s(C))("/password/forgot"))},{default:u(()=>[ee("Forgot Password?")]),_:1})])]),_:1}),v(re,{"login-loading":s(h).loginLoading,"login-title":"Log In","social-title":"Sign in with Google"},null,8,["login-loading"])]),_:1},8,["model","rules","onSubmit"])]),s(D)?(m(),V(le,{key:0,email:s(n).email,"dialog-visible":s(D),onClose:e[15]||(e[15]=t=>D.value=!1)},null,8,["email","dialog-visible"])):c("",!0),s(l).email.isShow&&!k()?(m(),V(P,{key:1,"dialog-visible":s(l).email.isShow&&!k(),"error-text":s(l).email.value,onVisible:e[16]||(e[16]=t=>s(l).email.isShow=!1)},null,8,["dialog-visible","error-text"])):c("",!0),s(l).password.isShow&&!k()?(m(),V(P,{key:2,"dialog-visible":s(l).password.isShow&&!k(),"error-text":s(l).password.value,onVisible:e[17]||(e[17]=t=>s(l).password.isShow=!1)},null,8,["dialog-visible","error-text"])):c("",!0)])}}},We=ue(Be,[["__scopeId","data-v-e7fa5156"]]);export{We as default};
