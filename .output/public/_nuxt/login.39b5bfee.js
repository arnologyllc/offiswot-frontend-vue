import{E as N,_ as C,a as R,b as j}from"./el-overlay.e870726e.js";import{E as G}from"./el-checkbox.23ef95ef.js";import{E as H}from"./el-button.e608a692.js";import{E as W,s as X,r as y,w as F,e as K,h as f,p as i,i as w,j as m,u as o,k as Q,c as V,l as g,m as Y,o as d,t as L,G as Z,v as T,z as ee,x as oe,y as se,f as v}from"./entry.dfd13bf6.js";import{_ as le,a as te}from"./OvConfirmEmailModal.143116d7.js";import{_ as ie}from"./lock-icon.f67239d1.js";import{L as ae}from"./LoginButtons.997c04ca.js";import{E as B}from"./ErrorMassageModal.72b1f162.js";import{h as ne,s as re}from"./eye-close-icon.3c80a0b0.js";import{_ as ue}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.5fde4ef1.js";import"./isEqual.ecd56be6.js";import"./flatten.44614476.js";import"./email-primary-icon.36ae4dae.js";import"./chevron-icon.53818441.js";const p=S=>(oe("data-v-adb8eac7"),S=S(),se(),S),me={class:"main"},de={class:"main__form"},pe=p(()=>i("div",{class:"main__form--title"},"Log In",-1)),_e=p(()=>i("div",{class:"main__form--subtitle"},"Please fill the forms to log in",-1)),ce={key:0,class:"el-form-item__global-error-container"},ge={class:"el-form-item__global-error"},ve=p(()=>i("img",{src:C,alt:""},null,-1)),fe=p(()=>i("img",{src:te,alt:"user_icon"},null,-1)),we=p(()=>i("span",{for:"email",class:"custom_placeholder"}," Email ",-1)),ke=[we],be=p(()=>i("div",null,null,-1)),ye={key:0,class:"el-form-item__error"},xe=p(()=>i("div",null,null,-1)),he=p(()=>i("img",{src:ie,alt:"password_icon"},null,-1)),Se=p(()=>i("span",{for:"password",class:"custom_placeholder"}," Password ",-1)),Ee=[Se],Ie=["src"],De={key:0,class:"el-form-item__error"},$e=["innerHTML"],Ve=p(()=>i("div",null,null,-1)),Te={class:"forgot-password"},Ce=p(()=>i("span",{style:{"font-weight":"400"}},"Remember me",-1)),Me={__name:"login",setup(S){const E=W(),{loginSuccessData:A,loginErrorData:q}=X(E),I=Y(),D=y(!1),$=y(!1),k=y(!1),_=y({ID:null,email:null,avatarUrl:null,token:null,token_expires:null,first_login:null,settings_pin_token:null,login_pin_token:null,login_pin_token_expires:null,workspaces:null}),a=y({email:null,password:null,remember_me:!1}),l=y({email:{value:"",isShow:!1},password:{value:"",isShow:!1},global:{value:""}}),O=y({email:[{required:!0,message:"This field is required.",trigger:"blur"}],password:[{required:!0,message:"This field is required.",trigger:"blur"}]});F(A,s=>{v.remove("token"),v.remove("first_login"),v.remove("settings_pin_token"),v.remove("login_pin_token"),v.remove("addAccount"),k.value=localStorage.getItem("accounts")!=="undefined"?JSON.parse(localStorage.getItem("accounts")):[],k.value.forEach((u,h)=>{u.email===s.user.email&&(_.value=u,k.value.splice(h,1))});const[e,n]=[s.access_token,s.is_first_login],c=a.value.remember_me?365:1/24;if(c!==365){const u=new Date;u.setMinutes(u.getMinutes()+10),_.value.token_expires=u}else{const u=new Date;u.setMonth(u.getMonth()+12),_.value.token_expires=u}v.set("token",e,{expires:c});const r=(Date.parse(_.value.login_pin_token_expires)-Date.now())/864e5;_.value.login_pin_token&&v.set("login_pin_token",_.value.login_pin_token,{expires:r}),_.value.email=s.user.email,_.value.token=e,_.value.first_login=n,k.value.push(_.value),k.value.forEach((u,h)=>u.ID=h),v.set("currentAccountID",k.value.length-1),localStorage.setItem("accounts",JSON.stringify(k.value)),n?(T("/pin"),v.set("first_login",n)):T("/")}),F(q,s=>{if(s==="Please visit your email to verify your account."||(s==null?void 0:s.error)==="Please visit your email to verify your account."){E.resendEmail(a.value.email),$.value=!0;return}if(s==="Incorrect email or password."&&(l.value.global.value=s),typeof s!="string")for(const e in s)if(typeof s[e]!="string")for(const n in s[e])l.value.global.value=s[e][n];else l.value.global.value=s[e]}),K(()=>{const s=new Date;s.setDate(s.getDate()+30),window.addEventListener("resize",z)});const U=()=>{I.refs.loginForm.validate(s=>{var e,n;if(s){const c=localStorage.getItem("accounts")!=="undefined"?(n=(e=JSON.parse(localStorage.getItem("accounts")))==null?void 0:e.map(r=>(Date.parse(r.token_expires)<new Date&&(r.token=null,r.token_expires=null,r.settings_pin_token=null),r)))==null?void 0:n.filter(r=>Date.parse(r.login_pin_token_expires)>new Date):[];c!=null&&c.some(r=>r.email===a.value.email&&r.token)?l.value.global.value="Account already logged in":(localStorage.setItem("accounts",JSON.stringify(c)),E.loginUser(a.value))}else return l.value.global.value="Please fill empty areas",!1})},M=s=>{I.refs[s].focus()},P=s=>{I.refs.loginForm.validateField(s,(e,n)=>{e?l.value[s].value="":l.value[s].value=n[s][0].message})},x=(s,e)=>{b()?l.value[s].isShow=e==="mouseover":e==="click"&&(l.value[s].isShow=!0)},z=()=>{I.update()},b=()=>window.innerWidth>990,J=()=>{l.value.global.value=""};return(s,e)=>{const n=R,c=j,r=G,u=H,h=N;return d(),f("div",me,[i("div",de,[pe,_e,w(h,{ref:"loginForm",class:"main__form--box","hide-required-asterisk":"",model:o(a),rules:o(O),onSubmit:Q(U,["prevent"])},{default:m(()=>[o(l).global.value?(d(),f("div",ce,[i("div",ge,[ve,i("span",null,L(o(l).global.value),1)]),i("span",{class:"clear-error",onClick:J},"X")])):g("",!0),w(c,{prop:"email"},{error:m(()=>[o(l).email.isShow&&b()?(d(),f("div",ye,[i("span",null,L(o(l).email.value),1)])):g("",!0),xe]),default:m(()=>[w(n,{ref:"email",modelValue:o(a).email,"onUpdate:modelValue":e[4]||(e[4]=t=>o(a).email=t),class:"main__form--box__input",placeholder:"Email",onBlur:e[5]||(e[5]=t=>P("email"))},{prefix:m(()=>[fe]),suffix:m(()=>[o(l).email.value?(d(),f("img",{key:0,class:"error_icon",src:C,alt:"",onMouseover:e[0]||(e[0]=t=>x("email","mouseover")),onMouseout:e[1]||(e[1]=t=>x("email","mouseout")),onClick:e[2]||(e[2]=t=>x("email","click"))},null,32)):g("",!0),o(a).email?(d(),f("div",{key:1,style:{position:"relative"},onClick:e[3]||(e[3]=t=>M("email"))},ke)):g("",!0),be]),_:1},8,["modelValue"])]),_:1}),w(c,{prop:"password",class:"password-form-item"},{error:m(()=>[o(l).password.isShow&&b()?(d(),f("div",De,[i("span",{innerHTML:o(l).password.value},null,8,$e)])):g("",!0),Ve]),default:m(()=>[w(n,{id:"password",ref:"password",modelValue:o(a).password,"onUpdate:modelValue":e[11]||(e[11]=t=>o(a).password=t),type:o(D)?"text":"password",class:"main__form--box__input",placeholder:"Password",onBlur:e[12]||(e[12]=t=>P("password"))},{prefix:m(()=>[he]),suffix:m(()=>[o(a).password?(d(),f("div",{key:0,style:{position:"relative"},onClick:e[6]||(e[6]=t=>M("password"))},Ee)):g("",!0),i("img",{class:Z(o(l).password.value?"eye_icon":""),src:o(D)?o(ne):o(re),alt:"eye_icon",onClick:e[7]||(e[7]=t=>D.value=!o(D))},null,10,Ie),o(l).password.value?(d(),f("img",{key:1,src:C,alt:"",class:"error_icon",onMouseover:e[8]||(e[8]=t=>x("password","mouseover")),onMouseout:e[9]||(e[9]=t=>x("password","mouseout")),onClick:e[10]||(e[10]=t=>x("password","click"))},null,32)):g("",!0)]),_:1},8,["modelValue","type"]),i("div",Te,[w(r,{modelValue:o(a).remember_me,"onUpdate:modelValue":e[13]||(e[13]=t=>o(a).remember_me=t),class:"remember-checkbox"},{default:m(()=>[Ce]),_:1},8,["modelValue"]),w(u,{text:"",onClick:e[14]||(e[14]=t=>("navigateTo"in s?s.navigateTo:o(T))("/password/forgot"))},{default:m(()=>[ee("Forgot Password?")]),_:1})])]),_:1}),w(ae,{"login-loading":o(E).loginLoading,"login-title":"Log In","social-title":"Sign in with Google"},null,8,["login-loading"])]),_:1},8,["model","rules","onSubmit"])]),o($)?(d(),V(le,{key:0,email:o(a).email,"dialog-visible":o($),onClose:e[15]||(e[15]=t=>$.value=!1)},null,8,["email","dialog-visible"])):g("",!0),o(l).email.isShow&&!b()?(d(),V(B,{key:1,"dialog-visible":o(l).email.isShow&&!b(),"error-text":o(l).email.value,onVisible:e[16]||(e[16]=t=>o(l).email.isShow=!1)},null,8,["dialog-visible","error-text"])):g("",!0),o(l).password.isShow&&!b()?(d(),V(B,{key:2,"dialog-visible":o(l).password.isShow&&!b(),"error-text":o(l).password.value,onVisible:e[17]||(e[17]=t=>o(l).password.isShow=!1)},null,8,["dialog-visible","error-text"])):g("",!0)])}}},We=ue(Me,[["__scopeId","data-v-adb8eac7"]]);export{We as default};
