import{E as R,_ as C,a as j,b as G}from"./el-overlay.e875a51a.js";import{E as W}from"./el-checkbox.73d29c2a.js";import{E as X}from"./el-button.baafa5c6.js";import"./el-form-item.4ed993c7.js";import{E as K,s as Q,r as h,w as B,e as Y,h as w,p as i,i as k,j as m,u as s,k as Z,c as $,l as g,m as ee,o as d,t as q,G as oe,v as V,z as se,x as le,y as te,f}from"./entry.1cc0a497.js";import{_ as ie,a as ae}from"./OvConfirmEmailModal.c10318cc.js";import{_ as ne}from"./lock-icon.3a510086.js";import{L as re}from"./LoginButtons.0240194f.js";import{E as N}from"./ErrorMassageModal.0a286fe8.js";import{h as ue,s as me}from"./eye-close-icon.e9487ca8.js";import{_ as de}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.f351b08e.js";import"./isEqual.7d2e83c5.js";import"./flatten.4d6c3a49.js";import"./email-primary-icon.34a61b4d.js";import"./chevron-icon.b7c58aba.js";const p=x=>(le("data-v-ca7d3e69"),x=x(),te(),x),pe={class:"main"},_e={class:"main__form"},ce=p(()=>i("div",{class:"main__form--title"},"Log In",-1)),ge=p(()=>i("div",{class:"main__form--subtitle"},"Please fill the forms to log in",-1)),fe={key:0,class:"el-form-item__global-error-container"},ve={class:"el-form-item__global-error"},we=p(()=>i("img",{src:C,alt:""},null,-1)),ke=p(()=>i("img",{src:ae,alt:"user_icon"},null,-1)),be=p(()=>i("span",{for:"email",class:"custom_placeholder"}," Email or username ",-1)),he=[be],ye=p(()=>i("div",null,null,-1)),xe={key:0,class:"el-form-item__error"},Se=p(()=>i("div",null,null,-1)),Ee=p(()=>i("img",{src:ne,alt:"password_icon"},null,-1)),Ie=p(()=>i("span",{for:"password",class:"custom_placeholder"}," Password ",-1)),De=[Ie],$e=["src"],Ve={key:0,class:"el-form-item__error"},Ce=["innerHTML"],Te=p(()=>i("div",null,null,-1)),Me={class:"forgot-password"},Pe=p(()=>i("span",{style:{"font-weight":"400"}},"Remember me",-1)),Fe={__name:"login",setup(x){const D=K(),{loginSuccessData:O,loginErrorData:U}=Q(D),S=ee(),E=h(!1),I=h(!1),b=h(!1),_=h({ID:null,email:null,avatarUrl:null,token:null,token_expires:null,first_login:null,settings_pin_token:null,login_pin_token:null,login_pin_token_expires:null,workspaces:null}),r=h({email:null,password:null,remember_me:!1}),l=h({email:{value:"",isShow:!1},password:{value:"",isShow:!1},global:{value:""}}),z=h({email:[{required:!0,message:"This field is required.",trigger:"blur"}],password:[{required:!0,message:"This field is required.",trigger:"blur"}]});B(O,o=>{f.remove("token"),f.remove("first_login"),f.remove("settings_pin_token"),f.remove("login_pin_token"),f.remove("addAccount"),b.value=localStorage.getItem("accounts")!=="undefined"?JSON.parse(localStorage.getItem("accounts")):[],b.value.forEach((n,y)=>{n.email===o.user.email&&(_.value=n,b.value.splice(y,1))});const[e,u]=[o.access_token,o.is_first_login],c=r.value.remember_me?365:1/24;if(c!==365){const n=new Date;n.setHours(n.getHours()+1),_.value.token_expires=n}else{const n=new Date;n.setMonth(n.getMonth()+12),_.value.token_expires=n}f.set("token",e,{expires:c});const a=(Date.parse(_.value.login_pin_token_expires)-Date.now())/864e5;_.value.login_pin_token&&f.set("login_pin_token",_.value.login_pin_token,{expires:a}),_.value.email=o.user.email,_.value.token=e,_.value.first_login=u,b.value.push(_.value),b.value.forEach((n,y)=>n.ID=y),f.set("currentAccountID",b.value.length-1),localStorage.setItem("accounts",JSON.stringify(b.value)),u?(V("/pin"),f.set("first_login",u)):V("/")}),B(U,o=>{if(o==="Please visit your email to verify your account."||(o==null?void 0:o.error)==="Please visit your email to verify your account."){I.value=!0;return}if(o==="Incorrect username or password."&&(l.value.global.value=o),typeof o!="string")for(const e in o)if(typeof o[e]!="string")for(const u in o[e])l.value.global.value=o[e][u];else l.value.global.value=o[e]}),Y(()=>{const o=new Date;o.setDate(o.getDate()+30),window.addEventListener("resize",H)});const A=()=>{S.refs.loginForm.validate(o=>{var e,u;if(o){const c=localStorage.getItem("accounts")!=="undefined"?(u=(e=JSON.parse(localStorage.getItem("accounts")))==null?void 0:e.map(a=>(Date.parse(a.token_expires)<new Date&&(a.token=null,a.token_expires=null,a.settings_pin_token=null),a)))==null?void 0:u.filter(a=>Date.parse(a.login_pin_token_expires)>new Date):[];c!=null&&c.some(a=>a.email===r.value.email&&a.token)?l.value.global.value="Account already logined":(localStorage.setItem("accounts",JSON.stringify(c)),D.loginUser(r.value))}else return l.value.global.value="Please fill empty areas",!1})},T=o=>{S.refs[o].focus()},M=o=>{S.refs.loginForm.validateField(o,(e,u)=>{e?l.value[o].value="":l.value[o].value=u[o][0].message})},P=o=>{l.value[o].isShow=!0},F=o=>{v()&&(l.value[o].isShow=!0)},L=o=>{v()&&(l.value[o].isShow=!1)},H=()=>{S.update()},v=()=>window.innerWidth>990,J=()=>{l.value.global.value=""};return(o,e)=>{const u=j,c=G,a=W,n=X,y=R;return d(),w("div",pe,[i("div",_e,[ce,ge,k(y,{ref:"loginForm",class:"main__form--box","hide-required-asterisk":"",model:s(r),rules:s(z),onSubmit:Z(A,["prevent"])},{default:m(()=>[s(l).global.value?(d(),w("div",fe,[i("div",ve,[we,i("span",null,q(s(l).global.value),1)]),i("span",{class:"clear-error",onClick:J},"X")])):g("",!0),k(c,{prop:"email"},{error:m(()=>[s(l).email.isShow&&v()?(d(),w("div",xe,[i("span",null,q(s(l).email.value),1)])):g("",!0),Se]),default:m(()=>[k(u,{ref:"email",modelValue:s(r).email,"onUpdate:modelValue":e[4]||(e[4]=t=>s(r).email=t),class:"main__form--box__input",placeholder:"Email or username",onBlur:e[5]||(e[5]=t=>M("email"))},{prefix:m(()=>[ke]),suffix:m(()=>[s(l).email.value?(d(),w("img",{key:0,class:"error_icon",src:C,alt:"",onMouseover:e[0]||(e[0]=t=>F("email")),onMouseout:e[1]||(e[1]=t=>L("email")),onClick:e[2]||(e[2]=t=>P("email"))},null,32)):g("",!0),s(r).email?(d(),w("div",{key:1,style:{position:"relative"},onClick:e[3]||(e[3]=t=>T("email"))},he)):g("",!0),ye]),_:1},8,["modelValue"])]),_:1}),k(c,{prop:"password",class:"password-form-item"},{error:m(()=>[s(l).password.isShow&&v()?(d(),w("div",Ve,[i("span",{innerHTML:s(l).password.value},null,8,Ce)])):g("",!0),Te]),default:m(()=>[k(u,{id:"password",ref:"password",modelValue:s(r).password,"onUpdate:modelValue":e[11]||(e[11]=t=>s(r).password=t),type:s(E)?"text":"password",class:"main__form--box__input",placeholder:"Password",onBlur:e[12]||(e[12]=t=>M("password"))},{prefix:m(()=>[Ee]),suffix:m(()=>[s(r).password?(d(),w("div",{key:0,style:{position:"relative"},onClick:e[6]||(e[6]=t=>T("password"))},De)):g("",!0),i("img",{class:oe(s(l).password.value?"eye_icon":""),src:s(E)?s(ue):s(me),alt:"eye_icon",onClick:e[7]||(e[7]=t=>E.value=!s(E))},null,10,$e),s(l).password.value?(d(),w("img",{key:1,src:C,alt:"",class:"error_icon",onMouseover:e[8]||(e[8]=t=>F("password")),onMouseout:e[9]||(e[9]=t=>L("password")),onClick:e[10]||(e[10]=t=>P("password"))},null,32)):g("",!0)]),_:1},8,["modelValue","type"]),i("div",Me,[k(a,{modelValue:s(r).remember_me,"onUpdate:modelValue":e[13]||(e[13]=t=>s(r).remember_me=t),class:"remember-checkbox"},{default:m(()=>[Pe]),_:1},8,["modelValue"]),k(n,{text:"",onClick:e[14]||(e[14]=t=>("navigateTo"in o?o.navigateTo:s(V))("/password/forgot"))},{default:m(()=>[se("Forgot Password?")]),_:1})])]),_:1}),k(re,{"login-loading":s(D).loginLoading,"login-title":"Log In","social-title":"Sign in with Google"},null,8,["login-loading"])]),_:1},8,["model","rules","onSubmit"])]),s(I)?(d(),$(ie,{key:0,email:s(r).email,"dialog-visible":s(I),onClose:e[15]||(e[15]=t=>I.value=!1)},null,8,["email","dialog-visible"])):g("",!0),s(l).email.isShow&&!v()?(d(),$(N,{key:1,"dialog-visible":s(l).email.isShow&&!v(),"error-text":s(l).email.value,onVisible:e[16]||(e[16]=t=>s(l).email.isShow=!1)},null,8,["dialog-visible","error-text"])):g("",!0),s(l).password.isShow&&!v()?(d(),$(N,{key:2,"dialog-visible":s(l).password.isShow&&!v(),"error-text":s(l).password.value,onVisible:e[17]||(e[17]=t=>s(l).password.isShow=!1)},null,8,["dialog-visible","error-text"])):g("",!0)])}}},Qe=de(Fe,[["__scopeId","data-v-ca7d3e69"]]);export{Qe as default};
