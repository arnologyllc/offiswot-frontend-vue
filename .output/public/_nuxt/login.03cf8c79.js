import{E as N,_ as B,a as j,b as R}from"./el-overlay.4b93bec8.js";import{E as G}from"./el-checkbox.849ebf82.js";import{E as W}from"./el-button.fb5dead5.js";import{G as X,s as K,r as g,w as P,f as Q,i as f,j as i,k as w,l as u,u as o,m as Y,c as T,p as c,q as Z,o as m,t as L,B as ee,z as F,A as oe,x as se,y as le,h as d}from"./entry.c6755e4d.js";import{_ as te,a as ie}from"./OvConfirmEmailModal.6f2256c2.js";import{_ as ae}from"./lock-icon.12f6376f.js";import{L as re}from"./LoginButtons.d1f990b8.js";import{E as A}from"./ErrorMassageModal.cd6bb512.js";import{h as ne,s as ue}from"./eye-close-icon.3601fe2b.js";import{_ as me}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.496d67e9.js";import"./isEqual.8ab74bf4.js";import"./flatten.70b97aa4.js";import"./email-primary-icon.6c8640f5.js";import"./chevron-icon.06312b0f.js";const p=h=>(se("data-v-ae56aeaa"),h=h(),le(),h),de={class:"main"},pe={class:"main__form"},_e=p(()=>i("div",{class:"main__form--title"},"Log In",-1)),ce=p(()=>i("div",{class:"main__form--subtitle"},"Please fill the forms to log in",-1)),ve={key:0,class:"el-form-item__global-error-container"},ge={class:"el-form-item__global-error"},fe=p(()=>i("img",{src:B,alt:""},null,-1)),we=p(()=>i("img",{src:ie,alt:"user_icon"},null,-1)),ke=p(()=>i("span",{for:"email",class:"custom_placeholder"}," Email ",-1)),be=[ke],ye=p(()=>i("div",null,null,-1)),Se={key:0,class:"el-form-item__error"},xe=p(()=>i("div",null,null,-1)),he=p(()=>i("img",{src:ae,alt:"password_icon"},null,-1)),Ee=p(()=>i("span",{for:"password",class:"custom_placeholder"}," Password ",-1)),Ie=[Ee],De=["src"],$e={key:0,class:"el-form-item__error"},Ve=["innerHTML"],Ce=p(()=>i("div",null,null,-1)),Te={class:"forgot-password"},Fe=p(()=>i("span",{style:{"font-weight":"400"}},"Remember me",-1)),Be={__name:"login",setup(h){const E=X(),{loginSuccessData:q,loginErrorData:O}=K(E),x=Z(),I=g(!1),D=g(!1),k=g(!1),V=g(!1),_=g({ID:null,email:null,avatarUrl:null,token:null,token_expires:null,first_login:null,settings_pin_token:null,login_pin_token:null,login_pin_token_expires:null,remember_token:null,workspaces:null}),n=g({email:null,password:null,remember_me:!1}),l=g({email:{value:"",isShow:!1},password:{value:"",isShow:!1},global:{value:""}}),U=g({email:[{required:!0,message:"This field is required.",trigger:"blur"},{type:"email",message:"Email is not valid.",trigger:"blur"}],password:[{required:!0,message:"This field is required.",trigger:"blur"}]});P(q,s=>{d.remove("token"),d.remove("first_login"),d.remove("settings_pin_token"),d.remove("remember_token"),d.remove("login_pin_token"),d.remove("addAccount"),k.value=localStorage.getItem("accounts")!=="undefined"?JSON.parse(localStorage.getItem("accounts")):[],k.value.forEach((S,t)=>{S.email===s.user.email&&(_.value=S,k.value.splice(t,1))});const[e,a]=[s.access_token,s.is_first_login],v=1/24,r=new Date;r.setHours(r.getHours()+1),_.value.token_expires=r,d.set("token",e,{expires:v}),d.set("remember_token",s.remember_token);const C=(Date.parse(_.value.login_pin_token_expires)-Date.now())/864e5;_.value.login_pin_token&&d.set("login_pin_token",_.value.login_pin_token,{expires:C}),_.value.email=s.user.email,_.value.token=e,_.value.first_login=a,_.value.remember_token=s.remember_token,k.value.push(_.value),k.value.forEach((S,t)=>S.ID=t),d.set("currentAccountID",k.value.length-1),localStorage.setItem("accounts",JSON.stringify(k.value)),a?(F("/pin"),d.set("first_login",a)):F("/")}),P(O,s=>{if(s==="Please visit your email to verify your account."||(s==null?void 0:s.error)==="Please visit your email to verify your account."){E.resendEmail(n.value.email),D.value=!0;return}if(s==="Incorrect email or password."&&(l.value.global.value=s),typeof s!="string")for(const e in s)if(typeof s[e]!="string")for(const a in s[e])l.value.global.value=s[e][a];else l.value.global.value=s[e]}),Q(()=>{const s=new Date;s.setDate(s.getDate()+30),window.addEventListener("resize",H)});const z=()=>{x.refs.loginForm.validate(s=>{var e,a;if(s){const v=localStorage.getItem("accounts")!=="undefined"?(a=(e=JSON.parse(localStorage.getItem("accounts")))==null?void 0:e.map(r=>(Date.parse(r.token_expires)<new Date&&(r.token=null,r.token_expires=null,r.settings_pin_token=null),r)))==null?void 0:a.filter(r=>Date.parse(r.login_pin_token_expires)>new Date):[];v!=null&&v.some(r=>r.email===n.value.email&&r.token)?l.value.global.value="Account already logged in":(localStorage.setItem("accounts",JSON.stringify(v)),E.loginUser(n.value))}else return l.value.global.value="Please fill empty areas",!1})},M=s=>{x.refs[s].focus()},$=s=>{x.refs.loginForm.validateField(s,(e,a)=>{e?l.value[s].value="":l.value[s].value=a[s][0].message}),Object.values(n.value).every((e,a)=>a===2||e)?x.refs.loginForm.validate(e=>V.value=e):V.value=!1},y=(s,e)=>{b()?l.value[s].isShow=e==="mouseover":e==="click"&&(l.value[s].isShow=!0)},H=()=>{x.update()},b=()=>window.innerWidth>990,J=()=>{l.value.global.value=""};return(s,e)=>{const a=j,v=R,r=G,C=W,S=N;return m(),f("div",de,[i("div",pe,[_e,ce,w(S,{ref:"loginForm",class:"main__form--box","hide-required-asterisk":"",model:o(n),rules:o(U),onSubmit:Y(z,["prevent"])},{default:u(()=>[o(l).global.value?(m(),f("div",ve,[i("div",ge,[fe,i("span",null,L(o(l).global.value),1)]),i("span",{class:"clear-error",onClick:J},"X")])):c("",!0),w(v,{prop:"email"},{error:u(()=>[o(l).email.isShow&&b()?(m(),f("div",Se,[i("span",null,L(o(l).email.value),1)])):c("",!0),xe]),default:u(()=>[w(a,{ref:"email",modelValue:o(n).email,"onUpdate:modelValue":e[4]||(e[4]=t=>o(n).email=t),class:"main__form--box__input",placeholder:"Email",onInput:e[5]||(e[5]=t=>$("email")),onBlur:e[6]||(e[6]=t=>$("email"))},{prefix:u(()=>[we]),suffix:u(()=>[o(l).email.value?(m(),f("img",{key:0,class:"error_icon",src:B,alt:"",onMouseover:e[0]||(e[0]=t=>y("email","mouseover")),onMouseout:e[1]||(e[1]=t=>y("email","mouseout")),onClick:e[2]||(e[2]=t=>y("email","click"))},null,32)):c("",!0),o(n).email?(m(),f("div",{key:1,style:{position:"relative"},onClick:e[3]||(e[3]=t=>M("email"))},be)):c("",!0),ye]),_:1},8,["modelValue"])]),_:1}),w(v,{prop:"password",class:"password-form-item"},{error:u(()=>[o(l).password.isShow&&b()?(m(),f("div",$e,[i("span",{innerHTML:o(l).password.value},null,8,Ve)])):c("",!0),Ce]),default:u(()=>[w(a,{id:"password",ref:"password",modelValue:o(n).password,"onUpdate:modelValue":e[12]||(e[12]=t=>o(n).password=t),type:o(I)?"text":"password",class:"main__form--box__input",placeholder:"Password",onInput:e[13]||(e[13]=t=>$("password")),onBlur:e[14]||(e[14]=t=>$("password"))},{prefix:u(()=>[he]),suffix:u(()=>[o(n).password?(m(),f("div",{key:0,style:{position:"relative"},onClick:e[7]||(e[7]=t=>M("password"))},Ie)):c("",!0),i("img",{class:ee(o(l).password.value?"eye_icon":""),src:o(I)?o(ne):o(ue),alt:"eye_icon",onClick:e[8]||(e[8]=t=>I.value=!o(I))},null,10,De),o(l).password.value?(m(),f("img",{key:1,src:B,alt:"",class:"error_icon",onMouseover:e[9]||(e[9]=t=>y("password","mouseover")),onMouseout:e[10]||(e[10]=t=>y("password","mouseout")),onClick:e[11]||(e[11]=t=>y("password","click"))},null,32)):c("",!0)]),_:1},8,["modelValue","type"]),i("div",Te,[w(r,{modelValue:o(n).remember_me,"onUpdate:modelValue":e[15]||(e[15]=t=>o(n).remember_me=t),class:"remember-checkbox"},{default:u(()=>[Fe]),_:1},8,["modelValue"]),w(C,{text:"",onClick:e[16]||(e[16]=t=>("navigateTo"in s?s.navigateTo:o(F))("/password/forgot"))},{default:u(()=>[oe("Forgot Password?")]),_:1})])]),_:1}),w(re,{"login-loading":o(E).loginLoading,"is-valid":o(V),"login-title":"Sign in","social-title":"Sign in with Google"},null,8,["login-loading","is-valid"])]),_:1},8,["model","rules","onSubmit"])]),o(D)?(m(),T(te,{key:0,email:o(n).email,"dialog-visible":o(D),onClose:e[17]||(e[17]=t=>D.value=!1)},null,8,["email","dialog-visible"])):c("",!0),o(l).email.isShow&&!b()?(m(),T(A,{key:1,"dialog-visible":o(l).email.isShow&&!b(),"error-text":o(l).email.value,onVisible:e[18]||(e[18]=t=>o(l).email.isShow=!1)},null,8,["dialog-visible","error-text"])):c("",!0),o(l).password.isShow&&!b()?(m(),T(A,{key:2,"dialog-visible":o(l).password.isShow&&!b(),"error-text":o(l).password.value,onVisible:e[19]||(e[19]=t=>o(l).password.isShow=!1)},null,8,["dialog-visible","error-text"])):c("",!0)])}}},Xe=me(Be,[["__scopeId","data-v-ae56aeaa"]]);export{Xe as default};
