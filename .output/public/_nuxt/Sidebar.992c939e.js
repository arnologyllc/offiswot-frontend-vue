import{E as le,a as ie,b as ce}from"./el-dropdown.f7961ece.js";import{E as ue}from"./el-button.e608a692.js";/* empty css                        */import"./el-popper.5b083fb9.js";import"./el-scrollbar.9e522778.js";import{A as _e,B as de,E as ve,a as pe,s as fe,bZ as ge,r as v,b as me,H as he,w as D,f as o,e as ke,C as we,o as p,h as f,p as n,F as O,q as j,i as _,j as c,u as k,G as I,l as H,v as g,P as Se,D as De,m as Ie,x as $e,y as be}from"./entry.dfd13bf6.js";import{d as w}from"./default-user-icon.4af4271a.js";import{_ as ye}from"./_plugin-vue_export-helper.c27b6911.js";import"./focus-trap.5fde4ef1.js";const xe=""+new URL("search.5b3fea75.svg",import.meta.url).href,Ae=""+new URL("new-chat.d41c9453.svg",import.meta.url).href,Ue=""+new URL("saved-messages.dcdaa155.svg",import.meta.url).href;const u=$=>($e("data-v-813f222d"),$=$(),be(),$),Ne={class:"main"},Ce={class:"users"},Ee={key:0,class:"main__top"},We=["onClick"],Oe=u(()=>n("div",{class:"current__user-selector"},null,-1)),Pe=["src"],Je=u(()=>n("i",{class:"el-icon-caret-bottom"},null,-1)),Le=u(()=>n("span",null,"Logout",-1)),Re=u(()=>n("div",{class:"current__workspace-selector"},null,-1)),Me=["src","title","onClick"],ze={class:"main__bottom"},Be=u(()=>n("div",{class:"main__user-actions--add_button"},[n("span",null,"+")],-1)),Fe={class:"chats-header"},Te=u(()=>n("img",{src:xe,alt:"",class:"chats__button-img"},null,-1)),Ve=u(()=>n("span",{class:"chats__button-text"},"Search",-1)),je=u(()=>n("img",{src:Ae,alt:"",class:"chats__button-img"},null,-1)),He=u(()=>n("span",{class:"chats__button-text"},"Create new chat",-1)),Ye=u(()=>n("img",{src:Ue,alt:"",class:"chats__button-img"},null,-1)),qe=u(()=>n("span",{class:"chats__button-text"},"Saved messages",-1)),Ge={__name:"Sidebar",setup($){const d=_e(),P=de(),J=ve(),L=pe(),{profileSuccessData:C,profileFailureData:Y,editProfileData:q,editFailureData:G,workspacesSuccessData:E}=fe(d),{$myFetch:Z}=ge(),R=De();v(w);const b=v(!1),K=Ie(),Q=v(null),y=me(),x=v(!1),t=v(!1),A=he(),s=v(null),m=v(!1),S=v(68),X=e=>{Q.value=e,e!=null&&e.user.avatar&&t.value[s.value]?t.value[s.value].avatarUrl=`${R.public.env.serverUrl}${e.avatarPath}/${e.user.avatar}`:t.value[s.value]&&(t.value[s.value].avatarUrl=`${w}`),localStorage.setItem("accounts",JSON.stringify(t.value))},M=e=>{t.value=JSON.parse(localStorage.getItem("accounts")),t.value[s.value]&&(t.value[s.value].workspaces=e==null?void 0:e.myWorkspaces),localStorage.setItem("accounts",JSON.stringify(t.value))};D(E,e=>M(e)),D(C,e=>{s.value=+o.get("currentAccountID"),e!=null&&e.user.avatar&&s.value>=0?t.value[s.value].avatarUrl=`${R.public.env.serverUrl}${e.avatarPath}/${e.user.avatar}`:s.value>=0&&(t.value[s.value].avatarUrl=`${w}`),localStorage.setItem("accounts",JSON.stringify(t.value))}),D(G,e=>{(e==null?void 0:e.error)==="You don't have permission to access this resource"&&(o.remove("login_pin_token"),o.remove("settings_pin_token"),e=null,y.go())}),D(Y,e=>{(e==null?void 0:e.error)==="You don't have permission to access this resource"&&(o.remove("login_pin_token"),o.remove("settings_pin_token"),e=null,y.go())}),D(q,e=>{e!=null&&e.user.avatar?t.value[s.value].avatarUrl=`${e.avatarPath}/${e.user.avatar}`:t.value[s.value].avatarUrl=`${w}`,localStorage.setItem("accounts",JSON.stringify(t.value))}),ke(async()=>{{t.value=JSON.parse(localStorage.getItem("accounts")).filter(a=>a.token);const e=window.location.pathname.split("/");isNaN(+e[e.length-1])||(m.value=e[e.length-1],s.value=null)}!m.value&&o.get("currentAccountID")?s.value=+o.get("currentAccountID"):m.value||(s.value=0),o.get("login_pin_token")&&(C.value?X(C.value):d.getProfile(),E.value?M(E.value):await d.getWorkSpaces()),window.addEventListener("resize",ee),window.innerWidth<800&&(b.value=!1,S.value=68)});const z=()=>{x.value="hovered"},B=()=>{x.value=!1},ee=()=>{window.innerWidth<800&&(b.value=!1,S.value=68),K.update()},U=async(e,a)=>{if(m.value=-1,s.value=t.value.findIndex(r=>r.ID===e),o.set("currentAccountID",s.value),t.value[s.value].token===o.get("token")){g("/");return}if(d.$reset(),P.$reset(),J.$reset(),L.$reset(),(Date.parse(t.value[s.value].token_expires)-Date.now())/864e5<0){t.value.splice(e,1),localStorage.setItem("accounts",JSON.stringify(t.value)),t.value[0]?U(0):(Object.keys(o.get()).forEach(function(r){o.remove(r,neededAttributes)}),y.go());return}o.set("token",t.value[s.value].token,{expires:(Date.parse(t.value[s.value].token_expires)-Date.now())/864e5}),o.set("first_login",t.value[s.value].first_login),t.value[s.value].settings_pin_token?o.set("settings_pin_token",t.value[s.value].settings_pin_token):o.remove("settings_pin_token"),t.value[s.value].login_pin_token?o.set("login_pin_token",t.value[s.value].login_pin_token,{expires:(Date.parse(t.value[s.value].login_pin_token_expires)-new Date)/864e5}):o.remove("login_pin_token"),localStorage.setItem("accounts",JSON.stringify(t.value)),t.value[s.value].first_login===!0?g("/pin"):A.path==="/pin"&&g("/"),d.getProfile(),await d.getWorkSpaces(),a||g("/")},te=async(e,a)=>{s.value=a,await U(a),s.value=-1,m.value=e,ae(e)},ae=e=>{g(`/workspace/staff/${e}`)},se=()=>{o.set("currentAccountID",t.value.length),o.set("addAccount",!0),window.open("/login","_blank")},oe=async e=>{t.value.forEach((l,N)=>l.ID=N),U(e),await Z("logout",{method:"post"});const a=t.value.map(l=>(l.ID===e&&(l.token=null,l.token_expires=null,l.first_login=null,l.settings_pin_token=null),l));d.$reset(),P.$reset(),J.$reset(),L.$reset();const r=a.findIndex(l=>l.token);a[r]?Date.parse(a[r].token_expires)-Date.now()>0?(o.set("token",a[r].token,{expires:(Date.parse(a[r].token_expires)-Date.now())/864e5}),a[r].first_login===!0&&o.set("first_login",a[r].first_login),a[r].settings_pin_token&&o.set("settings_pin_token",a[r].settings_pin_token),a[r].login_pin_token&&o.set("login_pin_token",a[r].login_pin_token,{expires:(Date.parse(a[r].login_pin_token_expires)-new Date)/864e5}),o.set("currentAccountID",r),d.getProfile(),await d.getWorkSpaces(),t.value=a,localStorage.setItem("accounts",JSON.stringify(a)),y.go()):a.shift():(o.remove("token"),o.remove("first_login"),o.remove("settings_pin_token"),o.remove("login_pin_token"),localStorage.setItem("accounts",JSON.stringify(a)),t.value=a,g("/login"))},F=(e,a)=>{switch(e){case"u":return a===s.value?"currentUser":!1;default:return a===+m.value?"currentWorkspace":!1}},ne=we(()=>t.value.reduce((e,a)=>(a.token&&e.push(a),e),[])),re=e=>{e.target.parentNode.style.cursor="e-resize",window.addEventListener("mousemove",T,!1),window.addEventListener("mouseup",()=>{e.target.parentNode.style.cursor="auto",window.removeEventListener("mousemove",T,!1)},!1)},T=e=>{S.value=e.x-68,b.value=S.value>85};return(e,a)=>{const r=le,l=ie,N=ce,W=ue;return p(),f("nav",Ne,[n("div",Ce,[t.value?(p(),f("div",Ee,[(p(!0),f(O,null,j(ne.value,i=>{var V;return p(),f(O,{key:i.ID},[_(N,{class:I(["main__user-actions",{currentUser:F("u",i.ID),bordered:(V=i.workspaces)==null?void 0:V.length}])},{dropdown:c(()=>[_(l,null,{default:c(()=>[_(r,{class:"main__user-actions--add_element",onClick:h=>oe(i.ID)},{default:c(()=>[Le]),_:2},1032,["onClick"])]),_:2},1024)]),default:c(()=>[n("div",{class:"main__user-actions--user",onClick:h=>U(i.ID)},[Oe,n("img",{src:i.avatarUrl?i.avatarUrl:k(w),alt:"Avatar",class:"main__user-actions--avatar"},null,8,Pe),Je],8,We)]),_:2},1032,["class"]),(p(!0),f(O,null,j(i.workspaces,h=>(p(),f("div",{key:h.id,class:I(["main__user-workspaces",F("w",h.id)])},[Re,n("img",{src:i.avatarUrl?i.avatarUrl:k(w),alt:"Avatar",class:"main__user-workspaces--avatar",title:h.name,onClick:Ze=>te(h.id,i.ID)},null,8,Me)],2))),128))],64)}),128))])):H("",!0),n("div",ze,[_(N,{class:"main__user-actions-add"},{dropdown:c(()=>[_(l,{class:"main__user-actions--add_actions"},{default:c(()=>[_(r,{class:"main__user-actions--add_element"},{default:c(()=>[n("span",{class:I(x.value),onClick:se,onMouseover:z,onMouseout:B}," Add account ",34)]),_:1}),_(r,{class:"main__user-actions--add_element"},{default:c(()=>[n("span",{class:I(x.value),onClick:a[0]||(a[0]=i=>("navigateTo"in e?e.navigateTo:k(g))("/profile/choose-account")),onMouseover:z,onMouseout:B}," Add workspace ",34)]),_:1})]),_:1})]),default:c(()=>[Be]),_:1})])]),k(A).path.includes("workspace")&&!k(A).path.includes("create-workspace")||k(A).fullPath=="/"?(p(),f("div",{key:0,class:I(["chats",b.value?"large":"small"]),style:Se({width:S.value+"px"})},[n("div",Fe,[_(W,{class:"chats__search"},{default:c(()=>[Te,Ve]),_:1}),_(W,{class:"chats__create"},{default:c(()=>[je,He]),_:1}),_(W,{class:"chats__saved"},{default:c(()=>[Ye,qe]),_:1})]),n("div",{class:"cursorbefore",onMousedown:re},null,32)],6)):H("",!0)])}}},rt=ye(Ge,[["__scopeId","data-v-813f222d"]]);export{rt as default};
